<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.prime.com.tr/ui"
	template="/pages/plantilla.xhtml">
	<ui:define name="title"> Gestion de Plazas </ui:define>
	<ui:define name="contenido">
		<f:view>
			<h:form id="formGestionServidores" prependId="false"
				style="font-size:10px;">
				<p:panel  header="Mantenimiento de Plazas">

					<p:layout style="min-width:300px;min-height:100px;">
						<p:layoutUnit position="center" maxWidth="400" >
							<p:dataTable id="tb_resumen" value="#{mantePlazasController.consolidadoCAP}" var="consol">
								<p:columnGroup type="header">
									<p:row>
										<p:column rowspan="2" headerText="Unidad" />
										<!-- <p:column colspan="3" headerText="Funcional" /> -->
										<p:column colspan="3" headerText="Presupuestado" />
										<p:column colspan="3" headerText="Previstos" />
										<p:column rowspan="2" headerText="Total" />
									</p:row>
									<p:row>
										<!-- <p:column headerText="Ocupado" />
										<p:column headerText="Vacante" />
										<p:column headerText="Total" /> -->
										<p:column headerText="Ocupado" />
										<p:column headerText="Vacante" />
										<p:column headerText="Total" />
										<p:column headerText="Aprobado" />
										<p:column headerText="Solicitado" />
										<p:column headerText="Total" />
									</p:row>
								</p:columnGroup>								
								<p:column><h:outputText value="#{consol.udDesc}"/></p:column>
								<!-- <p:column><h:outputText value="#{consol.ocupadoFuncional}"/></p:column>
								<p:column><h:outputText value="#{consol.libreFuncional}"/></p:column>
								<p:column><h:outputText value="#{consol.totalFunc}"/></p:column> -->
								<p:column><h:outputText value="#{consol.ocupado}"/></p:column>
								<p:column><h:outputText value="#{consol.libre}"/></p:column>
								<p:column><h:outputText value="#{consol.totalPres}"/></p:column>
								<p:column><h:outputText value="#{consol.aprobado}"/></p:column>
								<p:column><h:outputText value="#{consol.solicitado}"/></p:column>
								<p:column><h:outputText value="#{consol.totalPrev}"/></p:column>
								<p:column><h:outputText value="#{consol.total}"/></p:column>															
							</p:dataTable>
						</p:layoutUnit>
					</p:layout>
				

					<p:layout style="min-width:800px;min-height:505px;" id="layout">
						<p:layoutUnit position="left" header="Seleccione una dependencia"
							width="300" resizable="true" collapsible="true" scrollable="true">
							<p:tree value="#{listasController.root}" var="node"
								nodeSelectListener="#{mantePlazasController.onNodeSelect}"
								selectionMode="single"
								selection="#{mantePlazasController.selectedNode}"
								update="dtCarg,tb_resumen">
								<p:treeNode>
									<h:outputText value="#{node.udCod} - #{node.udDesc}" />
								</p:treeNode>
							</p:tree>

						</p:layoutUnit>
						<p:layoutUnit position="center" header="Elija una Plaza con doble click"
							id="layoutBusList">

							<h:panelGrid columns="9">
								<h:outputLabel value="AÃ±o: " for="listaAnios" />
								<h:selectOneMenu id="listaAnios" value="#{mantePlazasController.anio}"
									styleClass="ui-corner-all ui-widget-content ui-state-hover">
									<f:selectItems value="#{mantePlazasController.listaAnio}"
										var="ano" itemValue="#{ano}" itemLabel="#{ano}" />
									<p:ajax event="change"
										actionListener="#{mantePlazasController.obtenerAnio}"
										update="dtCarg,tb_resumen" />
								</h:selectOneMenu>
								
								<h:outputLabel value="Filtrar plazas por : " for="filtVac" />
								<h:selectOneMenu id="filtVac" value="#{mantePlazasController.filtrarPlazas}"
									styleClass="ui-corner-all ui-widget-content ui-state-hover">
									<f:selectItem itemLabel="Todos" 	itemValue="1" />
									<f:selectItem itemLabel="Vacantes" 	itemValue="2" />
									<f:selectItem itemLabel="Asignados" itemValue="3" />
									<p:ajax event="change"
										actionListener="#{mantePlazasController.actualizarListCargos2}"
										update="dtCarg" />
								</h:selectOneMenu>
								
								<h:outputLabel value="Clasificacion por : " for="filtroClasificacion" />
								<h:selectOneMenu id="filtroClasificacion" value="#{mantePlazasController.filtroClasificacion}"
									styleClass="ui-corner-all ui-widget-content ui-state-hover">
									<f:selectItem itemLabel="" 	itemValue="" />
									<f:selectItems value="#{mantePlazasController.listClasificaciones}"
										var="clasif" itemValue="#{clasif}" itemLabel="#{clasif}" />
									<p:ajax event="change"
										actionListener="#{mantePlazasController.filtrarClasificacionMethod}"
										update="dtCarg" />
								</h:selectOneMenu>
								<!-- <h:inputText id="filtroClasificacion"
									styleClass="ui-corner-all ui-widget-content ui-state-hover"
									value="#{mantePlazasController.filtroClasificacion}">
									<p:ajax event="keyup"
										actionListener="#{mantePlazasController.filtrarClasificacionMethod}"
										update="dtCarg"/>
								</h:inputText> -->
								
								<h:outputLabel value="Grupo Ocupacional por : " for="filtroGrupOcupacional" />
								<h:selectOneMenu id="filtroGrupOcupacional" value="#{mantePlazasController.filtroGrupOcupacional}"
									styleClass="ui-corner-all ui-widget-content ui-state-hover">
									<f:selectItem itemLabel="" 	itemValue="" />
									<f:selectItems value="#{mantePlazasController.listGrupoOcupacionales}"
										var="grup" itemValue="#{grup}" itemLabel="#{grup}" />
									<p:ajax event="change"
										actionListener="#{mantePlazasController.filtrarGrupoOcupacionalMethod}"
										update="dtCarg" />
								</h:selectOneMenu>
								<!-- <h:inputText id="filtroGrupOcupacional"
									styleClass="ui-corner-all ui-widget-content ui-state-hover"
									value="#{mantePlazasController.filtroGrupOcupacional}">
									<p:ajax event="keyup"
										actionListener="#{mantePlazasController.filtrarGrupoOcupacionalMethod}"
										update="dtCarg"/>
								</h:inputText> -->
								
								<!-- <h:selectBooleanCheckbox id="filtVac"
									value="#{mantePlazasController.filtrarVac}">
									<f:ajax
										listener="#{mantePlazasController.actualizarListCargos}"
										render="dtCarg" />
								</h:selectBooleanCheckbox> -->								
								<p:ajaxStatus style="width:16px;height:16px;">
									<f:facet name="start">
										<h:graphicImage value="../images/ajaxloading.gif" />
									</f:facet>
									<f:facet name="complete">
										<h:outputText value="" />
									</f:facet>
								</p:ajaxStatus>
							</h:panelGrid>

						 <p:dataTable id="dtCarg" var="cargo"
								value="#{mantePlazasController.listCargos}" paginator="true"
								rows="15" emptyMessage="No existen plazas para la unidad seleccionada"
								paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
								rowsPerPageTemplate="5,10,15" dblClickSelect="true"
								onRowSelectComplete="dlPlaza.show()" selectionMode="single"
								rowSelectListener="#{mantePlazasController.editarCargo}"
								selection="#{mantePlazasController.cargoSelected}"
								onRowSelectUpdate="panCargo">
								
								<p:column headerText="Cargo Clasif">
									<h:outputText value="#{cargo.descCargoClasif}" />
								</p:column>
								<p:column headerText="Cargo Est">
									<h:outputText value="#{cargo.descCargo}" />
								</p:column>
								<p:column headerText="Apellidos y Nombres">
									<h:outputText value="#{cargo.serExiste}" />
								</p:column>
								<p:column headerText="Codigo">
									<h:outputText value="#{cargo.numPlaza}" />
								</p:column>
								<p:column headerText="Clasificacion">
									<h:outputText value="#{cargo.clasificacion}" />
								</p:column>
								<p:column headerText="Grupo Ocup.">
									<h:outputText value="#{cargo.grupOcupacional}" />
								</p:column>
								<p:column headerText="Niv. Remun." rendered="#{!mantePlazasController.filtrarVac}">
									<h:outputText value="#{cargo.categoria}" />
								</p:column>
								<!-- <p:column headerText="Estado">
									<h:outputText value="#{cargo.estado_plaza}" />
								</p:column> -->
								<p:column headerText="Unidad">
									<h:outputText value="#{cargo.serDescDep}"
										rendered="#{mantePlazasController.nivel!=2 and mantePlazasController.nivel!=3 and mantePlazasController.nivel!=4 and mantePlazasController.nivel!=5 and mantePlazasController.nivel!=6 and mantePlazasController.nivel!=7}" />
									<h:outputText value="#{cargo.serDescDepNVL3}"
										rendered="#{mantePlazasController.nivel==2 or mantePlazasController.nivel==3 or mantePlazasController.nivel==4 or mantePlazasController.nivel==5 or mantePlazasController.nivel==6 or mantePlazasController.nivel==7}" />
								</p:column>

							</p:dataTable>
						</p:layoutUnit>
					</p:layout>
					<style>
						div.ui-datepicker {
							font-size: 12px !important;
						}
						/*
						div.ui-growl {													
							position:absolute;
							left:auto;	
							bottom:20px;
							top:auto;
							right:20px;							
						}
						*/
						.old{
							background: #679FD2;
						}
					</style>
					
					
					<p:growl id="observacion" showDetail="true" life="2000"/>
					<p:dialog widgetVar="dlPlaza" header="Editar Cargo" width="800"
						modal="true">
						<p:ajaxStatus style="width:16px;height:16px;">
									<f:facet name="start">
										<h:graphicImage value="../images/ajaxloading.gif" />
									</f:facet>
									<f:facet name="complete">
										<h:outputText value="" />
									</f:facet>
						</p:ajaxStatus>
						<h:panelGrid id="panCargo">
							<h:panelGrid
								rendered="#{mantePlazasController.renderServsAntiguos}"
								width="770">
								<p:dataTable id="dtServidores" var="serv"
									value="#{mantePlazasController.listServidoresAntiguos}"
									paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} 
			         				{LastPageLink} {RowsPerPageDropdown}"
									paginator="true" rows="12" rowsPerPageTemplate="4,8,12"
									selection="#{mantePlazasController.servidorAntSelected}"
									emptyMessage="No hay servidores para la unidad y anio seleccionado"
									rowSelectListener="#{mantePlazasController.observacion}"
									onRowSelectUpdate="observacion,fIngreso,fCese" selectionMode="single"
									rowStyleClass="#{serv.serColor}"
									>
									<!-- <p:column selectionMode="single" style="width:18px"/> -->
									
									<!-- <p:column selectionMode="single" style="width:18px"/> -->
									
									<p:column id="modelHeader0"
										filterBy="#{serv.serCod}"
										headerText="DNI" filterStyle="width:60px">
										<h:outputText
											value="#{serv.serCod}" />
									</p:column>
									
									<p:column id="modelHeader"
										filterBy="#{serv.serApePat} #{serv.serApeMat}, #{serv.serNom}"
										headerText="Apellidos y Nombres" filterStyle="width:240px">
										<h:outputText
											value="#{serv.serApePat} #{serv.serApeMat}, #{serv.serNom}" />
									</p:column>
									<p:column headerText="Categ">
										<h:outputText value="#{serv.serCategoria}" />
									</p:column>
									<p:column headerText="Estado">
										<h:outputText value="#{serv.serEstado}" />
									</p:column>
									<p:column headerText="Tipo" filterBy="#{serv.serTipo}">
										<h:outputText value="#{serv.serTipo}" />
									</p:column>
									<p:column headerText="Fecha de Ingreso">
										<h:outputText value="#{serv.serFech_in_unmsm_str}" />
									</p:column>
									
									<f:facet name="footer">  
								    	<p:commandButton value="#{mantePlazasController.botonServidores}" update="dtServidores, buttonGuardar" 
								    		actionListener="#{mantePlazasController.todosServidores}"/>  
								    </f:facet> 
								</p:dataTable>
								<p:panel>
									<center>
										<table>
											<tr>
												<td><h:outputText value="Fecha de Ingreso:" /></td>
												<td><p:calendar locale="es" id="fIngreso" yearRange="1950"
														value="#{mantePlazasController.plazaServidorEditable.fechaIni}"
														navigator="true" size="12" disabled="#{mantePlazasController.listaPlazaVacia}"
														mode="popup" showOn="button" readOnlyInputText="true"/></td>
												<TD>
													
													<!-- 
														<p:inputText value="#{mantePlazasController.plazaServidorEditable.n_resol_ing}"
													disabled="#{mantePlazasController.listaPlazaVacia}"/>
													 -->
													<h:selectOneMenu id="tipo_resolucion" value="#{mantePlazasController.tipo_resolucion}"
														styleClass="ui-corner-all ui-widget-content ui-state-hover">
														<f:selectItem itemLabel="Resolucion Rectoral" 	itemValue="RR" />
														<f:selectItem itemLabel="Resolucion Decanal" 	itemValue="RD" />
													</h:selectOneMenu>
													
													<p:inputMask id="num_resolucion" value="#{mantePlazasController.num_resolucion}" mask="99999"
														/>
													
													<h:selectOneMenu id="anio_resolucion" value="#{mantePlazasController.anio_resolucion}"
														styleClass="ui-corner-all ui-widget-content ui-state-hover">
														<f:selectItems value="#{mantePlazasController.anios}" />
													</h:selectOneMenu>
													
												</TD>
											</tr>
											<tr>
												<td><h:outputText value="Fecha de Cese:" /></td>
												<td><p:calendar  id="fCese"
														value="#{mantePlazasController.plazaServidorEditable.fechaFin}"
														navigator="true" size="12" disabled="#{mantePlazasController.listaPlazaVacia}"
														mode="popup" showOn="button" readOnlyInputText="true"/></td>
												<td>
													<h:selectOneMenu id="tipo_contrato" value="#{mantePlazasController.plazaServEstado.c_pla_serv_est}"
														styleClass="ui-corner-all ui-widget-content ui-state-hover">
														<f:selectItem itemLabel="Seleccione tipo de contrato" 	itemValue="0" />
														<f:selectItem itemLabel="Contrato" 						itemValue="1" />
														<f:selectItem itemLabel="Concurso" 						itemValue="2" />
														<f:selectItem itemLabel="Designacion"					itemValue="3" />
													</h:selectOneMenu>
												</td>
											</tr>
											<tr>
												<td colspan="4" align="center"><p:commandButton id="buttonGuardar"
														value="Guardar" disabled="#{mantePlazasController.listaPlazaVacia}"
														actionListener="#{mantePlazasController.guardarPlaza}"
														oncomplete="dlPlaza.hide()"
														update="dtCarg, notificacionCalificacion, tb_resumen" /></td>
											</tr>
										</table>
									</center>
								</p:panel>
							</h:panelGrid>


							<p:panel id="panCargo2"
								rendered="#{mantePlazasController.renderMostrarServ}"
								style="width:770">
								<center>
									<h:panelGrid width="745" columns="2">
										<h:outputText value="Nombre y Apellido:" />
										<h:outputText
											value="#{mantePlazasController.cargoSelected.serExiste}" />
										<h:outputText value="Descripcion del cargo:" />
										<h:outputText
											value="#{mantePlazasController.cargoSelected.descCargo}" />
										<h:outputText value="Numero de Plaza:" />
										<h:outputText
											value="#{mantePlazasController.cargoSelected.numPlaza}" />
										<h:outputText value="Unidad" />
										<h:outputText
											value="#{mantePlazasController.cargoSelected.serDescDep}" />
									</h:panelGrid>
									<p:commandButton value="Desasignar Servidor"
										actionListener="#{mantePlazasController.desasignarPlaza}"
										oncomplete="dlPlaza.hide()" update="dtCarg,tb_resumen" />
								</center>
							</p:panel>
						</h:panelGrid>
					</p:dialog>
					
				</p:panel>
				<div align="center"
					style="padding-left: 200px; padding-right: 200px;">
					<p:growl id="notificacionCalificacion" showDetail="true"
						life="3000"></p:growl>
				</div>
			</h:form>
		</f:view>
	</ui:define>
</ui:composition>