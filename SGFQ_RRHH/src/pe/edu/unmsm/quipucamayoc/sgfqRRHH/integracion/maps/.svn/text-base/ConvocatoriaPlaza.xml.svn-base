<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="ConvocatoriaPlaza"> 

	<typeAlias alias="ConvocatoriaPlazaDTO" type="pe.edu.unmsm.quipucamayoc.sgfqRRHH.negocio.dto.ConvocatoriaPlazaDTO"/>
	
	<resultMap class="ConvocatoriaPlazaDTO" id="rsConvPlaza">
		<result property="idConvocatoria" columnIndex="1"/>
		<result property="idPlaza" columnIndex="2"/>
		<result property="monto" columnIndex="3"/>
		<result property="fechaIni" columnIndex="4"/>
		<result property="fechaFin" columnIndex="5"/>
	</resultMap>
	
	<resultMap class="ConvocatoriaPlazaDTO" id="rsConvPlazaByIdConv">
		<result property="idConvocatoria" columnIndex="1"/>
		<result property="idPlaza" columnIndex="2"/>
		<result property="fechaIni" columnIndex="3"/>
		<result property="fechaFin" columnIndex="4"/>
		<result property="periodo" columnIndex="5"/>
		<result property="idCargo" columnIndex="6"/>
		<result property="descCargo" columnIndex="7"/>
		<result property="idDep" columnIndex="8"/>
		<result property="descDep" columnIndex="9"/>
		<result property="monto" columnIndex="10"/>
	</resultMap>
	
	<select id="selectConvPlaza" resultMap="rsConvPlaza" parameterClass="pe.edu.unmsm.quipucamayoc.sgfqRRHH.negocio.dto.ConvocatoriaPlazaDTO">
		SELECT
			N_ID_CONVOCATORIA,N_ID_PLAZA,
			F_FECHA_INI_CONTRATACION,F_FECHA_FIN_CONTRATACION 
		FROM
			QPDATAGESTION.TB_CONVOCATORIA_PLAZAS
		WHERE
			N_ID_PLAZA = #idPlaza#
	</select>
	
	<select id="selectConvPlazaByConv" resultMap="rsConvPlazaByIdConv" parameterClass="java.lang.Integer">
		SELECT
			cp.n_id_convocatoria,pl.c_id_plaza, cp.f_fecha_ini_contratacion, cp.f_fecha_fin_contratacion,
			to_char(cp.f_fecha_ini_contratacion,'dd/mm/yyyy') || ' - ' || to_char(cp.f_fecha_fin_contratacion,'dd/mm/yyyy') periodo,
       		car.c_id_cargo, car.t_desc_cargo, ud.ud_id, ud.ud_dsc, pl.n_monto
		FROM
			QPDATAGESTION.tb_convocatoria_plazas cp, QPDATAGESTION.tb_plaza pl,
			QPDATAGESTION.tb_cargo car, qprodataquipu.uni_dep ud
		WHERE
			cp.n_id_plaza = pl.c_id_plaza AND pl.n_id_cargo = car.c_id_cargo AND pl.n_id_dep = ud.ud_id AND
			cp.n_id_convocatoria = #idConvocatoria#
		ORDER BY
			cp.n_id_plaza
	</select>
	
	<insert id="insertConvPlaza" parameterClass="pe.edu.unmsm.quipucamayoc.sgfqRRHH.negocio.dto.ConvocatoriaPlazaDTO">
		INSERT INTO
			QPDATAGESTION.TB_CONVOCATORIA_PLAZAS
		VALUES
			(#idConvocatoria#,#idPlaza#,#fechaIni#,#fechaFin#)
	</insert>
	
	<update id="updateConvPlaza" parameterClass="pe.edu.unmsm.quipucamayoc.sgfqRRHH.negocio.dto.ConvocatoriaPlazaDTO">
		UPDATE
			QPDATAGESTION.TB_CONVOCATORIA_PLAZAS
		SET
			F_FECHA_INI_CONTRATACION = #fechaIni#,
			F_FECHA_FIN_CONTRATACION = #fechaFin#
		WHERE
			N_ID_PLAZA = #idPlaza# and N_ID_CONVOCATORIA = #idConvocatoria#
	</update>
	
	<delete id="deleteConvPlaza" parameterClass="pe.edu.unmsm.quipucamayoc.sgfqRRHH.negocio.dto.ConvocatoriaPlazaDTO">
		DELETE
			QPDATAGESTION.TB_CONVOCATORIA_PLAZAS
		WHERE
			N_ID_PLAZA = #idPlaza#
	</delete>
	
	<select id="obtenerMaxidConvPlaza" resultClass="java.lang.Integer">
		select
			max(N_ID_PLAZA)
		from
			QPDATAGESTION.TB_CONVOCATORIA_PLAZAS 
	</select>
</sqlMap>